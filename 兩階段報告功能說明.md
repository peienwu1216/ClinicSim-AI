# 兩階段報告生成功能說明

## 🎯 功能概述

ClinicSim-AI 現在支援兩階段的報告生成，提供更好的用戶體驗和更豐富的學習內容。

## 📊 第一階段：即時評估報告

### 特點
- **即時顯示**：問診結束後立即生成
- **快速評估**：基於規則的快速分析
- **覆蓋率統計**：即時顯示問診覆蓋率
- **基本建議**：提供核心改進建議

### 內容包含
- 問診覆蓋率分析
- 關鍵項目檢查清單
- 基本改進建議
- 快速評分

## 🤖 第二階段：完整分析報告 (LLM + RAG)

### 特點
- **按需生成**：用戶點擊按鈕後才生成
- **AI 驅動**：使用 LLM 進行深度分析
- **RAG 增強**：整合臨床指引和專業知識
- **詳細評估**：提供全面的學習建議

### 內容包含
1. **問診表現評估**
   - 系統性分析問診技巧
   - 優點和不足之處分析
   - 具體對話內容引用

2. **臨床決策分析**
   - 臨床思維過程評估
   - 關鍵症狀識別分析
   - 決策時效性和準確性評估

3. **知識應用評估**
   - 診斷流程理解評估
   - 標準化問診程序分析
   - 關鍵檢查認知評估

4. **改進建議**
   - 基於 RAG 臨床指引的具體建議
   - 實用學習資源推薦
   - 下一步學習重點建議

5. **評分總結**
   - 各項目具體評分 (1-10分)
   - 總體評價和等級
   - 額外練習建議

## 🔄 使用流程

### 學生使用流程
1. **進行問診**：與 AI 病人互動
2. **結束問診**：點擊「進入總結與計畫」
3. **查看即時報告**：立即獲得基本評估
4. **生成完整報告**：點擊「🤖 生成完整報告 (LLM + RAG)」
5. **深度學習**：基於詳細報告進行改進

### 技術實現
- **即時報告**：使用現有的 `get_feedback_report` API
- **詳細報告**：新增的 `get_detailed_report` API
- **RAG 整合**：多個查詢獲取全面臨床指引
- **LLM 分析**：使用 Ollama/Lemonade 進行深度分析

## 🎨 用戶界面設計

### 側邊欄
- 問診覆蓋率進度條
- 生命體徵監視器
- 「進入總結與計畫」按鈕
- 「🤖 生成完整報告」按鈕（問診結束後顯示）

### 主界面
- 即時報告區域（標題：📊 即時評估報告）
- 詳細報告區域（標題：🤖 完整分析報告 (LLM + RAG)）
- 提示信息引導用戶使用

## 🚀 優勢

### 用戶體驗
- **漸進式學習**：從基本到詳細
- **按需深度分析**：避免不必要的等待
- **清晰分類**：不同類型的報告分開顯示

### 技術優勢
- **效能優化**：即時報告不依賴 LLM
- **RAG 增強**：詳細報告包含專業知識
- **模組化設計**：易於維護和擴展

### 教學效果
- **即時回饋**：快速了解基本表現
- **深度分析**：基於臨床指引的專業建議
- **個性化學習**：針對性的改進建議

## 🔧 技術細節

### API 端點
- `POST /get_feedback_report` - 即時報告
- `POST /get_detailed_report` - 詳細報告

### RAG 查詢策略
- 多個相關查詢確保全面覆蓋
- 動態查詢生成基於對話內容
- 結果整合提供豐富上下文

### 錯誤處理
- 優雅的降級機制
- 用戶友好的錯誤訊息
- 備用方案確保功能可用性

## 📈 未來擴展

### 可能的改進
- 報告模板自定義
- 更多 RAG 查詢策略
- 報告導出功能
- 學習進度追蹤

### 整合可能性
- 與學習管理系統整合
- 多語言支援
- 個性化學習路徑
- 同儕比較功能

---

**總結**：兩階段報告功能為 ClinicSim-AI 帶來了更豐富的學習體驗，結合了即時回饋的便利性和 AI 深度分析的專業性，為醫學生提供了全面的臨床技能訓練支援。
