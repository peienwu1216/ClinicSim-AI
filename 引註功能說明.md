# 引註功能說明

## 🎯 功能概述

ClinicSim-AI 的詳細報告功能現在支援引註來源顯示，讓學生能夠清楚了解報告中建議的臨床指引來源，提升學習的透明度和可信度。

## 📚 引註功能特點

### 1. 自動引註生成
- **RAG 搜尋**：系統自動搜尋相關臨床指引
- **引註標記**：在報告中使用 `[引註 X]` 格式標記
- **來源追蹤**：每個引註都對應具體的查詢和來源

### 2. 視覺化引註顯示
- **高亮標記**：引註在報告中以藍色背景高亮顯示
- **可點擊展開**：點擊引註可查看詳細內容
- **來源資訊**：顯示查詢內容和原始指引

### 3. 繁體中文確保
- **語言檢查**：確保所有報告內容使用繁體中文
- **醫學術語**：使用正確的繁體中文醫學術語
- **專業表達**：適合醫學生學習的專業表達

## 🔍 引註 UI 設計

### 報告中的引註標記
```
根據 [引註 1] 的指引，ECG 檢查應在 10 分鐘內完成
```

### 引註詳情展開
```
📚 引註 1: 急性胸痛診斷流程和檢查順序
├── 來源：臨床指引 1
├── 查詢：急性胸痛診斷流程和檢查順序
└── 內容：[詳細的臨床指引內容]
```

### RAG 查詢摘要
```
🔍 RAG 查詢摘要
1. 急性胸痛診斷流程和檢查順序
2. ECG 心電圖在胸痛評估中的重要性
3. STEMI 和不穩定型心絞痛的診斷標準
4. 胸痛問診的 OPQRST 技巧和重點
```

## 🛠️ 技術實現

### 後端處理
1. **RAG 搜尋**：使用多個查詢獲取全面指引
2. **引註生成**：自動為每個 RAG 結果分配引註編號
3. **內容整合**：將引註標記整合到報告中
4. **備用方案**：如果 LLM 未生成引註，自動添加基於 RAG 的建議

### 前端顯示
1. **引註高亮**：使用 HTML 樣式高亮顯示引註標記
2. **展開詳情**：使用 Streamlit expander 顯示引註內容
3. **查詢摘要**：顯示所有 RAG 查詢的摘要

## 📊 引註內容結構

### 每個引註包含
- **ID**：引註編號 (1, 2, 3, 4...)
- **查詢**：RAG 搜尋的原始查詢
- **來源**：臨床指引來源標識
- **內容**：從 RAG 系統獲取的詳細指引內容

### RAG 查詢策略
1. **急性胸痛診斷流程和檢查順序**
2. **ECG 心電圖在胸痛評估中的重要性**
3. **STEMI 和不穩定型心絞痛的診斷標準**
4. **胸痛問診的 OPQRST 技巧和重點**

## 🎨 用戶體驗

### 學生使用流程
1. **生成詳細報告**：點擊「生成完整報告」按鈕
2. **查看報告內容**：閱讀包含引註標記的報告
3. **探索引註詳情**：點擊引註標記查看詳細內容
4. **學習臨床指引**：基於引註內容深入學習

### 視覺效果
- **引註標記**：藍色背景，圓角邊框，粗體字
- **展開按鈕**：清晰的展開/收合按鈕
- **內容組織**：結構化的引註資訊顯示

## 🔧 配置選項

### 引註樣式自定義
```python
# 引註高亮樣式
style = "background-color: #e1f5fe; padding: 2px 6px; border-radius: 4px; font-weight: bold; color: #0277bd;"
```

### RAG 查詢自定義
```python
rag_queries = [
    "急性胸痛診斷流程和檢查順序",
    "ECG 心電圖在胸痛評估中的重要性",
    "STEMI 和不穩定型心絞痛的診斷標準",
    "胸痛問診的 OPQRST 技巧和重點"
]
```

## 📈 學習效果

### 透明度提升
- 學生可以清楚看到建議的來源
- 增強對 AI 建議的信任度
- 促進批判性思維

### 學習深度
- 提供具體的臨床指引參考
- 支持進一步的自主學習
- 建立知識與實踐的連結

### 專業成長
- 學習如何引用臨床指引
- 培養循證醫學思維
- 提升臨床決策能力

## 🚀 未來擴展

### 可能的改進
- 引註來源的更多元化
- 引註內容的智能摘要
- 引註相關性評分
- 引註使用統計分析

### 整合可能性
- 與學習管理系統整合
- 引註內容的版本控制
- 多語言引註支援
- 引註內容的協作編輯

---

**總結**：引註功能為 ClinicSim-AI 帶來了更高的透明度和學習價值，讓學生不僅能獲得 AI 建議，更能了解建議的來源和依據，促進更深層的學習和專業成長。
