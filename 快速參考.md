# ClinicSim-AI 快速參考

## 🚀 本地開發快速啟動

### 第一次設定
```bash
# 1. 克隆專案
git clone <repository-url>
cd ClinicSim-AI

# 2. 建立虛擬環境
python -m venv venv
source venv/bin/activate  # macOS/Linux
# 或 venv\Scripts\activate  # Windows

# 3. 安裝依賴
pip install -r requirements.txt

# 4. 建立 RAG 索引
python build_index.py

# 5. 設定環境變數
echo "OLLAMA_HOST=http://127.0.0.1:11434" > .env
echo "OLLAMA_MODEL=llama3:8b" >> .env

# 6. 啟動 Ollama (可選)
ollama serve
ollama pull llama3:8b

# 7. 啟動系統
python server.py &  # 後端
streamlit run app.py  # 前端
```

### 日常開發
```bash
# 啟動虛擬環境
source venv/bin/activate

# 啟動系統
python server.py &  # 終端 1
streamlit run app.py  # 終端 2
```

## 🖥️ AMD AI PC 部署

### 準備階段 (本地)
```bash
# 1. 建立索引
python build_index.py

# 2. 打包索引
tar -czf faiss_index.tar.gz faiss_index/

# 3. 上傳到 AMD AI PC
scp -r . user@amd-ai-pc:/path/to/deployment/
scp faiss_index.tar.gz user@amd-ai-pc:/path/to/deployment/ClinicSim-AI/
```

### 部署階段 (AMD AI PC)
```bash
# 1. 解壓縮索引
cd /path/to/deployment/ClinicSim-AI
tar -xzf faiss_index.tar.gz

# 2. 安裝依賴
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt

# 3. 啟動系統
python server.py
```

## 🔧 常用指令

### RAG 系統
```bash
# 重新建立索引
rm -rf faiss_index/
python build_index.py

# 測試 RAG 系統
python -c "
from rag_handler import rag_system
result = rag_system.search('ECG 心電圖的重要性')
print(result)
"
```

### 系統測試
```bash
# 測試後端 API
curl -X POST http://localhost:5001/ask_patient \
  -H "Content-Type: application/json" \
  -d '{"history": [{"role": "user", "content": "你好"}], "case_id": "case_chest_pain_acs_01"}'

# 測試詳細報告
curl -X POST http://localhost:5001/get_detailed_report \
  -H "Content-Type: application/json" \
  -d '{"full_conversation": [{"role": "user", "content": "測試"}], "case_id": "case_chest_pain_acs_01"}'
```

### 依賴管理
```bash
# 更新依賴
pip install --upgrade pip
pip install -r requirements.txt --force-reinstall

# 檢查依賴
pip list
pip check
```

## 📁 重要檔案

### 核心檔案
- `app.py` - Streamlit 前端界面
- `server.py` - Flask 後端 API
- `rag_handler.py` - RAG 系統處理器
- `build_index.py` - RAG 索引建立腳本

### 配置檔案
- `requirements.txt` - Python 依賴清單
- `.env` - 環境變數設定
- `cases/case_chest_pain_acs_01.json` - 案例配置

### 資料檔案
- `documents/` - 臨床指引文件
- `faiss_index/` - RAG 向量索引 (不進版本控制)

## 🐛 快速故障排除

### 常見問題
```bash
# 1. RAG 索引載入失敗
rm -rf faiss_index/
python build_index.py

# 2. 依賴安裝失敗
pip install --upgrade pip
pip install -r requirements.txt --force-reinstall

# 3. Ollama 連接失敗
ollama serve
ollama list

# 4. 記憶體不足
# 減少 documents/ 中的文件數量
# 調整 build_index.py 中的 chunk_size
```

### 檢查系統狀態
```bash
# 檢查 Python 進程
ps aux | grep python

# 檢查端口使用
netstat -tulpn | grep :5001
netstat -tulpn | grep :8501

# 檢查記憶體使用
free -h
top -o %MEM
```

## 📊 開發工作流程

### 添加新功能
1. 在本地開發環境中開發
2. 測試功能正常運作
3. 提交代碼到 Git
4. 更新部署到 AMD AI PC

### 添加新案例
1. 在 `cases/` 中建立 JSON 檔案
2. 更新 `app.py` 中的 `CASE_ID`
3. 測試案例功能

### 添加新指引
1. 將文件放入 `documents/`
2. 執行 `python build_index.py`
3. 重啟系統

## 🔍 除錯技巧

### 日誌檢查
```bash
# 查看後端日誌
python server.py 2>&1 | tee server.log

# 查看前端日誌
streamlit run app.py --logger.level debug
```

### 測試特定功能
```bash
# 測試 RAG 搜尋
python -c "
from rag_handler import rag_system
print(rag_system.search('你的查詢'))
"

# 測試案例載入
python -c "
import json
with open('cases/case_chest_pain_acs_01.json', 'r') as f:
    case = json.load(f)
print('案例載入成功:', case['case_id'])
"
```

## 📞 緊急聯絡

### 系統無法啟動
1. 檢查日誌檔案
2. 重啟服務
3. 重新部署
4. 聯繫技術支援

### 功能異常
1. 檢查依賴是否完整
2. 驗證 RAG 索引是否正常
3. 測試 API 端點
4. 查看錯誤訊息

---

**快速參考版本**：v1.0.0
**最後更新**：2025年9月
