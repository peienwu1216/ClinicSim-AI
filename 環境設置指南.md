# ClinicSim-AI 環境設置指南

## 📋 概述

本專案支持多平台開發和部署，針對不同環境提供優化的依賴配置。

## 🖥️ 支持的環境

| 環境 | 用途 | 推薦配置文件 |
|------|------|-------------|
| **macOS** | 開發環境 | `requirements-dev.txt` |
| **Windows** | 開發環境 | `requirements-windows.txt` |
| **Lemonade Server** | 比賽/生產環境 | `requirements-lemonade.txt` |

## 🚀 快速安裝

### 方法一：自動安裝（推薦）

```bash
# 自動檢測環境並安裝
python install.py
```

### 方法二：手動安裝

#### macOS 開發環境
```bash
pip install -r requirements-dev.txt
```

#### Windows 開發環境
```bash
pip install -r requirements-windows.txt
```

#### Lemonade Server 生產環境
```bash
pip install -r requirements-lemonade.txt
```

## 📦 依賴文件說明

### `requirements-base.txt`
- **用途**: 所有環境的核心依賴
- **包含**: Flask, Streamlit, 數據處理庫等基礎組件
- **適用**: 所有環境的基礎安裝

### `requirements-dev.txt`
- **用途**: 開發環境完整依賴
- **包含**: Ollama, 開發工具, 測試框架
- **適用**: macOS 和 Windows 開發

### `requirements-windows.txt`
- **用途**: Windows 環境優化
- **包含**: Windows 特殊依賴, 兼容性修復
- **適用**: Windows 開發環境

### `requirements-production.txt`
- **用途**: 生產環境優化
- **包含**: 生產服務器, 監控工具
- **適用**: 一般生產部署

### `requirements-lemonade.txt`
- **用途**: Lemonade Server 環境
- **包含**: 最小依賴集, 比賽環境優化
- **適用**: 比賽和演示環境

## 🔧 環境特定配置

### macOS 開發環境
```bash
# 創建虛擬環境
python -m venv venv
source venv/bin/activate

# 安裝開發依賴
pip install -r requirements-dev.txt

# 啟動服務
python main.py  # 後端
streamlit run app_new.py  # 前端
```

### Windows 開發環境
```bash
# 創建虛擬環境
python -m venv venv
venv\Scripts\activate

# 安裝 Windows 優化依賴
pip install -r requirements-windows.txt

# 如果遇到 FAISS 問題，可以嘗試：
pip install chromadb  # 替代方案
```

### Lemonade Server 環境
```bash
# 安裝生產依賴
pip install -r requirements-lemonade.txt

# 啟動生產服務器
gunicorn -w 4 -b 0.0.0.0:8000 main:app
```

## ⚠️ 常見問題

### Windows 上的 FAISS 問題
```bash
# 如果 faiss-cpu 安裝失敗，使用替代方案：
pip install chromadb
# 然後修改代碼使用 ChromaDB 而不是 FAISS
```

### 依賴衝突
```bash
# 清理環境
pip freeze > current_requirements.txt
pip uninstall -r current_requirements.txt -y
pip install -r requirements-dev.txt
```

### 版本兼容性
```bash
# 檢查 Python 版本
python --version  # 需要 Python 3.8+

# 升級 pip
python -m pip install --upgrade pip
```

## 🧪 測試安裝

安裝完成後，運行測試：

```bash
python quick_test.py
```

## 📝 環境變量設置

創建 `.env` 文件：

```env
# AI 服務配置
OLLAMA_HOST=http://127.0.0.1:11434
OLLAMA_MODEL=llama3:8b

# 服務器配置
HOST=0.0.0.0
PORT=5001
DEBUG=true

# RAG 配置
RAG_INDEX_PATH=faiss_index
EMBEDDING_MODEL=nomic-ai/nomic-embed-text-v1.5
```

## 🔄 更新依賴

```bash
# 更新所有依賴到最新版本
pip install -r requirements-dev.txt --upgrade

# 生成當前環境的依賴列表
pip freeze > requirements-current.txt
```

## 📞 支援

如果遇到問題：

1. 檢查 Python 版本 (需要 3.8+)
2. 確認虛擬環境已激活
3. 查看錯誤日誌
4. 嘗試使用替代依賴方案

---

**注意**: 不同環境可能需要不同的配置，請根據實際情況調整。
